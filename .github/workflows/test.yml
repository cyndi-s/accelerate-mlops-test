name: Run Tests

on:
  push:
    branches: [main]
  pull_request:
    paths:
      - "src/**"
      - "tests/**"
      - ".github/**"
      - "examples/**"
      - "setup.py"
    types: [opened, synchronize, reopened]

env:
  HF_HOME: ~/hf_cache
  TESTING_MOCKED_DATALOADERS: "1"
  IS_GITHUB_CI: "1"

jobs:
  run-tests:
    name: Pre-check (lightweight)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Show repo info
        run: |
          echo "Repo: $GITHUB_REPOSITORY"
          echo "SHA:  $GITHUB_SHA"

  devops-mlops-report:
    name: DevOps-MLOps-Report (inline)
    needs: [run-tests]
    if: ${{ always() }}
    uses: cyndi-s/devops-mlops-report/.github/workflows/ci-report.yml@report-v2
    permissions:
      actions: read
      contents: read
    with:
      config_path: report-config.yml
    secrets:
      GIST_TOKEN: ${{ secrets.GIST_TOKEN }}
      DAGSHUB_TOKEN: ${{ secrets.DAGSHUB_TOKEN }}
